# Пример использования API на PowerShell

Полная документация API https://wiki.logistpro.su/display/LKB/LogistPro+API

## Запуск примера
Для запуска примера, необходимо:
1. установить [PowerShell 3](https://docs.microsoft.com/en-us/skypeforbusiness/set-up-your-computer-for-windows-powershell/download-and-install-windows-powershell-3-0) (при необходимости)
2. заполнить необходимые константы в файле [ApiExample.ps1](ApiExample.ps1)
	- базовые настройки доступа (актуализировать базовые настройки можно в [Wiki](https://wiki.logistpro.su/display/LKB/LogistPro+API) проекта)
	```PowerShell
	# базовые настройки доступа
	$API_BASE_HOST = "http://..."
	$API_BASE_URL = $API_BASE_HOST+"/api/v1/"
	```
	- API ключ личного кабинета компании (запросить ключ можно обратившись в [Службу поддержки](https://jira.logistpro.su/servicedesk/customer/portal/4) или написав заявку по адресу support@logistpro.su)
	```PowerShell
	# API ключ личного кабинета компании
	$API_KEY = "..."
	```
	- логин/пароль технического аккаунта (можно использовать любой логин/пароль пользователя из личного кабинета компании)
	```PowerShell
	# логин/пароль технического аккаунта с максимальными правами доступа
	$LOGIN = "..."
	$PASSWORD = "..."
	```
3. открыть консоль PowerShell
3. запустить скрипт командой
	```
	.\ApiExample.ps1
	```
	Если запуск скриптов запрещен политикой, то можно воспользоваться [Set-ExecutionPolicy](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.security/set-executionpolicy?view=powershell-3.0) для изменения локальной политики.

## Сценарий примера
Сценарий реализован в виде последовательности запросов к API, реализующих функции создания и контроля статуса заказа.

0. Настройка передачи API ключа в заголовках HTTP запросов
1. Проверка доступности API
2. Авторизация заданным пользователем
	- получение авторизационной куки
	- настройка передачи авторизации в заголовках HTTP запросов
3. Получение справочников с сервера
4. Создание запроса на транспорт (с датой исполнения +7 дней вперед)
5. Проверка статуса созданного запроса с получением дополнительной информации:
	- Статус с расшифровкой
	- Время последнего изменения статуса
	- Количество предложений
	- Текущее лучшее предложение